
# Java Base Features

## Java 语言编程规范

1. 枚举类，接口的属性，类中 static final 修饰的属性是常量。
2. 不建议使用一个常量类管理所有常量，推荐按功能设置常量类进行管理。
3. mutable 对象禁止定义为常量，例如 `static final Result SUCCESS = new Result(0, "success")`, 虽然 SUCCESS 引用不可变，但是所指的对象 `Result(0, "success")` 的属性是可变的。
4. 类中声明的顺序：
   1. 类变量
   2. 静态初始化块
   3. 实例变量
   4. 实例初始化块
   5. 构造方法
   6. 方法
5. 大数值写法，添加 `_` 方便看数值大小，例如 `30_000_000`
6. 局部变量，类的成员变量声明时，每行只能声明一个变量
   1. 局部变量需要在创建时声明值。
   2. 类的成员变量要在构造方法内集中声明。
7. float 精度约 6-7 位，double 精度约 15 位，float 和 double 都是浮点数。
   1. NaN 不是一个数字，可以由`0/0`或负数平方根产生，不能用 == 判断一个浮点数是不是NaN, 可以用 `isNaN` 判断一个数是不是 NaN。
   2. 浮点数不能进行精确计算，所以不能用等值判断，但是可以用 `== 0`。
   3. 因为不能等值判断，浮点数不要用做`Map`的key。
   4. 可以用`BigDecimal`进行精确计算，需要用字符串初始化。
8. String 类被 final 修饰，因此不能被继承。
   1. String 类中字符串数组被 `private final` 修饰，表示创建后不可被修改。
9. 不同系统中换行符，文件分隔符不一致，使用 `System.lineSeparator()` 获取换行符，使用`java.io.File`中的`separator`或`pathSeparator`获取文件路径分隔符。
10. 考虑地区语言差异，转换实现时，使用`Locale`指定语言环境，例如`toUpperCase(Locale.Root)`，`String.format(Locale.Root, "%d", 2);`。
11. 主动将敏感信息清0，防止泄露敏感信息。
    1. `Arrays.fill(password, (char) 0x00)`
    2. String 通过反射的方式清零字符串。
12. Java 对应的装箱和拆箱操作。
    1. 不当的代码会有大量的装箱，拆箱操作，影响性能。
    2. 实际应用中优先使用基本类型，包装类型的合理使用场景有：
       1. 作为集合中元素，键和值。
       2. 作为泛型。
       3. 反射方法需要调用包装类。
       4. POJO类的属性，RPC方法返回值和参数需要序列化且可能缺失值的场景。
    3. 包装类比较时，应使用`equals()`，`compareTo()`等方法，不要使用 == 进行等值判断。
    4. 包装类型用于数值计算，设计拆箱操作，可能会出现`NullPointException`。
13. 需要使用括号明确运算顺序，比如涉及到位运算操作，多种操作且优先级混淆。
14. 在对象可能为 null 的情况下，要明确处理 null 的场景。对于 `NullPointException` 应在代码中应优先通过预检查的方式消除空指针引用。
15. 断言(assert)可以通过配置关闭和禁用，不建议使用 assert 作为业务代码。
16. 返回值不返回 null，降低程序抛出`NPE`的可能性。
    1. 返回数组的场景，推荐返回长度为0的数组。
    2. 返回集合的场景，推荐返回空集合。
    3. 其他场景使用 `Optional` 代替 null 作为返回值。
       1. 禁止对`Optional`对象赋值/返回null，或与 null 比较。
       2. 对于`Optional<Integer>`，`Optional<Long>`，`Optional<Double>` 应使用`OptionalInt`, `OptionalLong`, `OptionalDouble`代替。
       3. 如果文档注释明确返回值用于数值计算密集型，或者用于序列化，那么可以返回`T`，或者 null，无需 `Optional<T>`。
       4. 一般不应返回 `Optional<集合或数组>`，而用空集合或空数组代替。
       5. `Optional.of()`参数不能为null，否则也会抛出 NPE 。
    
### 类和接口设计指导原则。

1. 




## Java 编写规范

1. 方法行数不超过50行（非空非注释）。
2. 方法参数不超过5个。
   1. 可以尝试相关参数合成一个类。
   2. 构造方法参数过多时，可以考虑使用Builder模式或工厂模式。
   3. 对方法进行抽象和重构。
3. 方法最大代码块嵌套深度不超过4层。
4. 方法抛出的异常类型不超过5类，并通过JavaDoc中@throw标签进行说明。

## Java 编程技巧

1. Java 的 int 和 long，会有最大值限制，如果两数相加数值超过最大值，会产生整数溢出且不能会异常提示，可以使用 `Math.addExact` 计算可能会发生整数溢出的计算。




























